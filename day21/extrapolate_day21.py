import math

import numpy as np
import pandas as pd
from matplotlib import pyplot as plt


def main():
    times = {
        1: 5.416997737484053e-06,
        11: 0.00199162500211969,
        21: 0.02631856100197183,
        31: 0.08410734599965508,
        41: 0.18077014300070005,
        51: 0.319277320002584,
        61: 0.4893767739995383,
        71: 0.7420007639993855,
        81: 1.0517980530021305,
        91: 1.3418233859993052,
        101: 1.7911039649989107,
        111: 2.269133829999191,
        121: 2.9751122989982832,
        131: 3.544501885997306,
        141: 3.8379905359979603,
        151: 4.611959761001344,
        161: 5.464824837003107,
        171: 7.171356653998373,
        181: 6.889502722999168,
        191: 7.905431603001489}
    results = {
        1: 27,
        11: 19612618,
        21: 105619718613031,
        31: 518295575789482417419,
        41: 2674444981899569877000237869,
        51: 14062064215101208361591017398917158,
        61: 75006828441029745774458611519686991867159,
        71: 404330720064877512899776690731906852687312453668,
        81: 2197131792364585482019241497391149511016381844236493309,
        91: 12014921645723434641815176353562014547173044675841245867971316,
        101: 66039540017199933787251814143013716754685773731623370884844735238653,
        111: 364516135538460112941154559267898891638040935662596284798567687301544947911,
        121: 2019130093172231084427781124492641404112043129202493725707752364326220086546046337,
        131: 11218060583854447161179111796191192648046578239406478409135647998248544544726744618686614,
        141: 62487901001504352423194015797838701729119299923450766756588296862119918071619725109916359053696,
        151: 348861293649213706429062109300978139873352861667455861715533794836813161614093920622858183474431177081,
        161: 1951502148129522839759698390757258849286228747365252095443596076430244259384057010612493853175013833273147554,
        171: 10935683555777803701019720127219135166746013233060331554219404402850742896786921609353260503040293200156716222032866,
        181: 61376318945939128012250539849887906127636175060861795430019623484891974276543624652268077249422650407307286991250803795074,
        191: 344956130285455730374017181014585786561294081435228141215605663896311542100801843407836439210890212570758923205021781956069183902}
    extrapolate_cubic(times)
    results = {key: float(val) for key, val in results.items()}
    extrapolate_exponential(results)


def extrapolate_cubic(times):
    time_series = pd.Series(times)
    time_fit = np.polyfit(time_series.index, time_series.values, 2)
    predicted_time = np.polyval(time_fit, time_series.index)
    predicted_series = pd.Series(predicted_time, index=time_series.index)
    time_series.plot()
    predicted_series.plot()
    print("Predicted time: ", np.polyval(time_fit, 1000) / 60, "minutes")
    plt.show()


def extrapolate_exponential(values):
    series = pd.Series(values)
    fit = np.polyfit(series.index, np.log(series.values), 1)
    prediction = np.exp(np.polyval(fit, series.index))
    predicted_series = pd.Series(prediction, index=series.index)
    series.plot(logy=True)
    predicted_series.plot(logy=True)
    full_exponent = np.polyval(fit, 1000) * 0.43429
    log_mantissa, exponent = math.modf(full_exponent)
    mantissa = 10**log_mantissa
    print(f"Predicted value: {mantissa} * 10^{int(exponent)}")
    plt.show()


if __name__ == "__main__":
    main()
